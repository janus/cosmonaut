PLATFORM := $(shell sh -c 'uname -s 2>/dev/null | tr 'a-z' 'A-Z'')
PREFIX?=/usr/local
CFLAGS=-g -Wall -D$(PLATFORM)
LDFLAGS=-lev

all: deps cosmonaut

cosmonaut: ../deps/dict/dict.o ../deps/concat/concat.o ../deps/url_parser/url.o ../deps/iniparser/dictionary.o ../deps/iniparser/iniparser.o ../deps/http_parser/http_parser.o mpart_body_processor.o attrs_map.o multipart_parser.o str_map.o log.o headers_map.o routes_map.o platform.o file_util.o routing_engine.o action.o http_response.o base_request_handler.o configuration.o networking.o signals.o cli.o string_util.o http_request.o

deps:
	cd ../deps && make

install: all
	install -d $(DESTDIR)/$(PREFIX)/bin/
	install cosmonaut $(DESTDIR)/$(PREFIX)/bin/

clean:
	cd ../deps && make clean
	rm -f *.o
	rm -f cosmonaut
	rm -rf *.dSYM

dep:
	$(CC) -MM *.c -I ../deps/iniparser/

